<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Amazon SES Setup Guide - Help Desk</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      line-height: 1.6;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
      color: #333;
    }
    h1 {
      color: #ff9900;
      border-bottom: 3px solid #ff9900;
      padding-bottom: 10px;
    }
    h2 {
      color: #232f3e;
      margin-top: 40px;
      border-left: 4px solid #ff9900;
      padding-left: 15px;
    }
    h3 {
      color: #232f3e;
      margin-top: 25px;
    }
    .step {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .step-number {
      display: inline-block;
      background: #ff9900;
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      text-align: center;
      line-height: 30px;
      font-weight: bold;
      margin-right: 10px;
    }
    code {
      background: #fff3e0;
      padding: 2px 8px;
      border-radius: 4px;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 0.9em;
    }
    pre {
      background: #232f3e;
      color: #f8f8f2;
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 0.9em;
    }
    .warning {
      background: #fff3e0;
      border-left: 4px solid #ff9800;
      padding: 15px;
      margin: 15px 0;
      border-radius: 0 8px 8px 0;
    }
    .info {
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
      padding: 15px;
      margin: 15px 0;
      border-radius: 0 8px 8px 0;
    }
    .success {
      background: #e8f5e9;
      border-left: 4px solid #4caf50;
      padding: 15px;
      margin: 15px 0;
      border-radius: 0 8px 8px 0;
    }
    .danger {
      background: #ffebee;
      border-left: 4px solid #f44336;
      padding: 15px;
      margin: 15px 0;
      border-radius: 0 8px 8px 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
      background: white;
      border-radius: 8px;
      overflow: hidden;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e0e0e0;
    }
    th {
      background: #232f3e;
      color: white;
    }
    tr:hover {
      background: #f5f5f5;
    }
    a {
      color: #ff9900;
    }
    .toc {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
    }
    .toc ul {
      list-style: none;
      padding-left: 0;
    }
    .toc li {
      padding: 5px 0;
    }
    .back-link {
      display: inline-block;
      margin-bottom: 20px;
      padding: 10px 20px;
      background: #ff9900;
      color: white;
      text-decoration: none;
      border-radius: 4px;
    }
    .back-link:hover {
      background: #e68a00;
    }
    .cost-box {
      background: #e8f5e9;
      border: 2px solid #4caf50;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
    }
    .cost-box h4 {
      margin-top: 0;
      color: #2e7d32;
    }
  </style>
</head>
<body>
  <a href="javascript:window.close()" class="back-link">Close This Guide</a>

  <h1>Amazon SES Setup Guide</h1>

  <div class="toc">
    <h3>Table of Contents</h3>
    <ul>
      <li><a href="#overview">Overview</a></li>
      <li><a href="#create-account">1. AWS Account Setup</a></li>
      <li><a href="#verify-domain">2. Verify Your Domain</a></li>
      <li><a href="#create-iam">3. Create IAM User</a></li>
      <li><a href="#configure-firebase">4. Configure Firebase Secrets</a></li>
      <li><a href="#inbound-email">5. Set Up Inbound Email (Optional)</a></li>
      <li><a href="#sandbox">6. Request Production Access</a></li>
      <li><a href="#testing">7. Testing</a></li>
      <li><a href="#troubleshooting">Troubleshooting</a></li>
    </ul>
  </div>

  <h2 id="overview">Overview</h2>
  <div class="step">
    <p>Amazon Simple Email Service (SES) is a cost-effective, scalable email service built on AWS infrastructure. It's one of the most affordable options for sending transactional emails.</p>

    <div class="cost-box">
      <h4>Cost Comparison</h4>
      <p><strong>Amazon SES:</strong> $0.10 per 1,000 emails</p>
      <p>For a help desk sending 1,000 emails/month: approximately <strong>$0.10/month</strong></p>
    </div>

    <div class="info">
      <strong>What you'll need:</strong>
      <ul>
        <li>An AWS account</li>
        <li>Access to your domain's DNS settings</li>
        <li>Firebase CLI installed on your computer</li>
      </ul>
    </div>

    <div class="warning">
      <strong>Important:</strong> New AWS accounts start in "sandbox" mode, which limits sending to verified email addresses only. You'll need to request production access to send to any email address.
    </div>
  </div>

  <h2 id="create-account">1. AWS Account Setup</h2>
  <div class="step">
    <p><span class="step-number">1</span> Go to <a href="https://aws.amazon.com" target="_blank">aws.amazon.com</a> and click <strong>Create an AWS Account</strong></p>

    <p><span class="step-number">2</span> Complete the registration (you'll need a credit card, but SES has a generous free tier)</p>

    <p><span class="step-number">3</span> Once logged in, search for <strong>SES</strong> in the AWS Console search bar</p>

    <p><span class="step-number">4</span> Select a region close to your users. Note which region you choose:</p>
    <table>
      <tr>
        <th>Region Name</th>
        <th>Region Code</th>
      </tr>
      <tr>
        <td>US East (N. Virginia)</td>
        <td><code>us-east-1</code></td>
      </tr>
      <tr>
        <td>US West (Oregon)</td>
        <td><code>us-west-2</code></td>
      </tr>
      <tr>
        <td>Europe (Ireland)</td>
        <td><code>eu-west-1</code></td>
      </tr>
    </table>

    <div class="info">
      <strong>Tip:</strong> <code>us-east-1</code> is the most common choice and has all SES features available.
    </div>
  </div>

  <h2 id="verify-domain">2. Verify Your Domain</h2>
  <div class="step">
    <p>Before sending emails, you must verify ownership of your domain.</p>

    <p><span class="step-number">1</span> In the SES Console, click <strong>Verified identities</strong> in the left sidebar</p>

    <p><span class="step-number">2</span> Click <strong>Create identity</strong></p>

    <p><span class="step-number">3</span> Select <strong>Domain</strong></p>

    <p><span class="step-number">4</span> Enter your domain (e.g., <code>mail.yourdomain.com</code>)</p>

    <p><span class="step-number">5</span> Under <strong>Advanced DKIM settings</strong>, keep the defaults (Easy DKIM)</p>

    <p><span class="step-number">6</span> Click <strong>Create identity</strong></p>

    <h3>Add DNS Records</h3>
    <p><span class="step-number">7</span> AWS will show you DNS records to add. Add these to your domain's DNS:</p>

    <table>
      <tr>
        <th>Record Type</th>
        <th>Purpose</th>
        <th>Name Format</th>
      </tr>
      <tr>
        <td>CNAME (x3)</td>
        <td>DKIM Authentication</td>
        <td><code>xxxx._domainkey.yourdomain.com</code></td>
      </tr>
      <tr>
        <td>TXT</td>
        <td>Domain Verification</td>
        <td><code>_amazonses.yourdomain.com</code></td>
      </tr>
    </table>

    <p><span class="step-number">8</span> Wait for verification (usually 15-30 minutes, can take up to 72 hours)</p>

    <div class="success">
      When verified, you'll see a green "Verified" badge next to your domain.
    </div>
  </div>

  <h2 id="create-iam">3. Create IAM User</h2>
  <div class="step">
    <p>You need AWS credentials to send emails from your application.</p>

    <p><span class="step-number">1</span> In the AWS Console, search for <strong>IAM</strong> and open it</p>

    <p><span class="step-number">2</span> Click <strong>Users</strong> in the left sidebar</p>

    <p><span class="step-number">3</span> Click <strong>Create user</strong></p>

    <p><span class="step-number">4</span> Enter a username: <code>helpdesk-ses-sender</code></p>

    <p><span class="step-number">5</span> Click <strong>Next</strong></p>

    <h3>Set Permissions</h3>
    <p><span class="step-number">6</span> Select <strong>Attach policies directly</strong></p>

    <p><span class="step-number">7</span> Search for and select <strong>AmazonSESFullAccess</strong></p>

    <p><span class="step-number">8</span> Click <strong>Next</strong>, then <strong>Create user</strong></p>

    <h3>Create Access Keys</h3>
    <p><span class="step-number">9</span> Click on the user you just created</p>

    <p><span class="step-number">10</span> Go to the <strong>Security credentials</strong> tab</p>

    <p><span class="step-number">11</span> Under <strong>Access keys</strong>, click <strong>Create access key</strong></p>

    <p><span class="step-number">12</span> Select <strong>Application running outside AWS</strong></p>

    <p><span class="step-number">13</span> Click <strong>Create access key</strong></p>

    <div class="danger">
      <strong>IMPORTANT:</strong> Copy and save both the <strong>Access key ID</strong> and <strong>Secret access key</strong> NOW. The secret key is only shown once and cannot be retrieved later!
    </div>

    <p>Your keys will look like:</p>
    <ul>
      <li><strong>Access Key ID:</strong> <code>AKIAIOSFODNN7EXAMPLE</code></li>
      <li><strong>Secret Access Key:</strong> <code>wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY</code></li>
    </ul>
  </div>

  <h2 id="configure-firebase">4. Configure Firebase Secrets</h2>
  <div class="step">
    <p>Store your AWS credentials as Firebase secrets.</p>

    <p><span class="step-number">1</span> Open a terminal and navigate to your project's <code>functions</code> directory</p>

    <p><span class="step-number">2</span> Run these commands one by one:</p>

    <pre>firebase functions:secrets:set AWS_ACCESS_KEY_ID</pre>
    <p>When prompted, paste your Access Key ID</p>

    <pre>firebase functions:secrets:set AWS_SECRET_ACCESS_KEY</pre>
    <p>When prompted, paste your Secret Access Key</p>

    <pre>firebase functions:secrets:set AWS_SES_REGION</pre>
    <p>When prompted, enter your region (e.g., <code>us-east-1</code>)</p>

    <p><span class="step-number">3</span> Deploy your functions:</p>
    <pre>firebase deploy --only functions</pre>

    <div class="success">
      <strong>Done!</strong> Your Help Desk can now send emails via Amazon SES.
    </div>
  </div>

  <h2 id="inbound-email">5. Set Up Inbound Email (Optional)</h2>
  <div class="step">
    <p>If you want customers to reply to tickets via email, you need to configure SES email receiving.</p>

    <div class="warning">
      <strong>Note:</strong> Email receiving is only available in these regions:
      <ul>
        <li>US East (N. Virginia) - <code>us-east-1</code></li>
        <li>US West (Oregon) - <code>us-west-2</code></li>
        <li>Europe (Ireland) - <code>eu-west-1</code></li>
      </ul>
    </div>

    <h3>Add MX Record</h3>
    <p><span class="step-number">1</span> Add an MX record to your domain's DNS:</p>
    <table>
      <tr>
        <th>Type</th>
        <th>Name</th>
        <th>Priority</th>
        <th>Value</th>
      </tr>
      <tr>
        <td>MX</td>
        <td><code>mail</code></td>
        <td>10</td>
        <td><code>inbound-smtp.us-east-1.amazonaws.com</code></td>
      </tr>
    </table>
    <p>(Replace <code>us-east-1</code> with your region)</p>

    <h3>Create Receipt Rule Set</h3>
    <p><span class="step-number">2</span> In SES Console, go to <strong>Email receiving</strong> &rarr; <strong>Rule sets</strong></p>

    <p><span class="step-number">3</span> Click <strong>Create rule set</strong></p>

    <p><span class="step-number">4</span> Name it <code>helpdesk-rules</code> and create it</p>

    <p><span class="step-number">5</span> Click <strong>Set as active</strong></p>

    <h3>Create Receipt Rule</h3>
    <p><span class="step-number">6</span> In your rule set, click <strong>Create rule</strong></p>

    <p><span class="step-number">7</span> Name: <code>helpdesk-inbound</code></p>

    <p><span class="step-number">8</span> Recipients: Add your email pattern, e.g., <code>mail.yourdomain.com</code></p>

    <p><span class="step-number">9</span> Click <strong>Next</strong></p>

    <h3>Configure SNS Action</h3>
    <p><span class="step-number">10</span> Click <strong>Add action</strong> &rarr; <strong>Publish to Amazon SNS topic</strong></p>

    <p><span class="step-number">11</span> Create a new SNS topic named <code>helpdesk-inbound-emails</code></p>

    <p><span class="step-number">12</span> Set encoding to <strong>UTF-8</strong></p>

    <p><span class="step-number">13</span> Click <strong>Next</strong> &rarr; <strong>Create rule</strong></p>

    <h3>Subscribe Firebase Function to SNS</h3>
    <p><span class="step-number">14</span> Go to <strong>Amazon SNS</strong> Console</p>

    <p><span class="step-number">15</span> Find your topic and click <strong>Create subscription</strong></p>

    <p><span class="step-number">16</span> Configure:</p>
    <ul>
      <li><strong>Protocol:</strong> HTTPS</li>
      <li><strong>Endpoint:</strong> Your Firebase function URL:
        <pre>https://us-central1-YOUR-PROJECT-ID.cloudfunctions.net/sesWebhook</pre>
      </li>
    </ul>

    <p><span class="step-number">17</span> Click <strong>Create subscription</strong></p>

    <div class="info">
      The subscription will be automatically confirmed by your Firebase function.
    </div>
  </div>

  <h2 id="sandbox">6. Request Production Access</h2>
  <div class="step">
    <p>New SES accounts are in "sandbox" mode with these limitations:</p>
    <ul>
      <li>Can only send to verified email addresses</li>
      <li>Maximum 200 emails per 24 hours</li>
      <li>Maximum 1 email per second</li>
    </ul>

    <h3>Request Production Access</h3>
    <p><span class="step-number">1</span> In SES Console, go to <strong>Account dashboard</strong></p>

    <p><span class="step-number">2</span> Find the <strong>Sandbox</strong> banner and click <strong>Request production access</strong></p>

    <p><span class="step-number">3</span> Fill out the form:</p>
    <ul>
      <li><strong>Mail type:</strong> Transactional</li>
      <li><strong>Website URL:</strong> Your help desk URL</li>
      <li><strong>Use case description:</strong> Example:
        <pre>We operate a help desk system that sends transactional emails including:
- Ticket confirmation emails to customers who submit support requests
- Notification emails to support staff when new tickets are created
- Updates when tickets are replied to or resolved
All emails are opt-in and related to customer support interactions.</pre>
      </li>
    </ul>

    <p><span class="step-number">4</span> Submit the request</p>

    <div class="info">
      AWS typically reviews and approves production access requests within 24-48 hours.
    </div>
  </div>

  <h2 id="testing">7. Testing</h2>
  <div class="step">
    <h3>Test While in Sandbox</h3>
    <p>Before getting production access, you can test by verifying a test email address:</p>

    <p><span class="step-number">1</span> In SES, go to <strong>Verified identities</strong></p>
    <p><span class="step-number">2</span> Click <strong>Create identity</strong></p>
    <p><span class="step-number">3</span> Select <strong>Email address</strong></p>
    <p><span class="step-number">4</span> Enter your personal email and verify it</p>
    <p><span class="step-number">5</span> Now create a ticket using that email as the submitter</p>

    <h3>Test Outbound Email</h3>
    <p><span class="step-number">1</span> Create a new ticket in your Help Desk</p>
    <p><span class="step-number">2</span> Check that notification emails are received</p>

    <h3>Check Logs</h3>
    <p>If emails aren't working, check the Firebase Functions logs:</p>
    <pre>firebase functions:log</pre>
  </div>

  <h2 id="troubleshooting">Troubleshooting</h2>
  <div class="step">
    <h3>Emails Not Sending</h3>
    <table>
      <tr>
        <th>Problem</th>
        <th>Solution</th>
      </tr>
      <tr>
        <td><code>AccessDenied</code> error</td>
        <td>Check IAM user has <code>AmazonSESFullAccess</code> policy</td>
      </tr>
      <tr>
        <td><code>MessageRejected</code> error</td>
        <td>You're in sandbox mode - verify recipient email or request production access</td>
      </tr>
      <tr>
        <td>Domain not verified</td>
        <td>Check DNS records are correct; wait for propagation</td>
      </tr>
      <tr>
        <td>Wrong region</td>
        <td>Ensure <code>AWS_SES_REGION</code> matches where you verified your domain</td>
      </tr>
    </table>

    <h3>Inbound Emails Not Working</h3>
    <table>
      <tr>
        <th>Problem</th>
        <th>Solution</th>
      </tr>
      <tr>
        <td>MX record not found</td>
        <td>Verify MX record: <code>dig MX mail.yourdomain.com</code></td>
      </tr>
      <tr>
        <td>SNS subscription pending</td>
        <td>Check function logs for subscription confirmation; manually confirm if needed</td>
      </tr>
      <tr>
        <td>Rule not matching</td>
        <td>Verify receipt rule recipients match your email pattern</td>
      </tr>
    </table>

    <h3>Verify Your Configuration</h3>
    <pre>firebase functions:secrets:access AWS_ACCESS_KEY_ID
firebase functions:secrets:access AWS_SES_REGION</pre>

    <div class="info">
      <strong>Need Help?</strong> Check the <a href="https://docs.aws.amazon.com/ses/" target="_blank">AWS SES Documentation</a> or contact your system administrator.
    </div>
  </div>

  <p style="text-align: center; margin-top: 40px; color: #666;">
    <a href="javascript:window.close()" class="back-link">Close This Guide</a>
  </p>
</body>
</html>
